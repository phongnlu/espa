window.ESPA=window.ESPA||{},window.ESPA.route=function(){"use strict";function e(e){return e.split(/[\/?#]/)}function t(e,t){var n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*"),r=new RegExp("^"+n+"$"),i=e.match(r);return i?i.slice(1):void 0}function n(e,t){var n;return function(){clearTimeout(n),n=setTimeout(e,t)}}function r(e){p=n(c,1),K[A](E,p),K[A](P,p),N[A](k,l),e&&c(!0)}function i(){this.$=[],g(this),q.on("stop",this.s.bind(this)),q.on("emit",this.e.bind(this))}function o(e){return e.replace(/^\/|\/$/,"")}function u(e){return"string"==typeof e}function a(e){return(e||T.href).replace(b,"")}function f(e){return"#"===h[0]?(e||T.href||"").split(h)[1]||"":(T?a(e):e||"").replace(h,"")}function c(e){var t=0===_;if(!(_>=x)&&(_++,R.push(function(){var t=f();(e||t!==d)&&(q[$]("emit",t),d=t)}),t)){for(var n;n=R.shift();)n();_=0}}function l(e){if(!(1!==e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;!t||"A"!==t.nodeName||t[S]("download")||!t[S]("href")||t.target&&"_self"!==t.target||-1===t.href.indexOf(T.href.match(b)[0])||(t.href===T.href||!(t.href.split("#")[0]===T.href.split("#")[0]||"#"!==h[0]&&0!==a(t.href).indexOf(h)||"#"===h[0]&&t.href.split(h)[0]!==T.href.split(h)[0])&&s(f(t.href),t.title||N.title))&&e.preventDefault()}}function s(e,t,n){return O?(e=h+o(e),t=t||N.title,n?O.replaceState(null,t,e):O.pushState(null,t,e),N.title=t,L=!1,c(),L):q[$]("emit",f(e))}var p,h,d,m,v,g=function(e){e=e||{};var t={},n=Array.prototype.slice;return Object.defineProperties(e,{on:{value:function(n,r){return"function"==typeof r&&(t[n]=t[n]||[]).push(r),e},enumerable:!1,writable:!1,configurable:!1},off:{value:function(n,r){if("*"!=n||r)if(r)for(var i,o=t[n],u=0;i=o&&o[u];++u)i==r&&o.splice(u--,1);else delete t[n];else t={};return e},enumerable:!1,writable:!1,configurable:!1},one:{value:function(t,n){function r(){e.off(t,r),n.apply(e,arguments)}return e.on(t,r)},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(r){var i,o,u,a=arguments,f=arguments.length-1,c=new Array(f);for(u=0;f>u;u++)c[u]=a[u+1];for(i=n.call(t[r]||[],0),u=0;o=i[u];++u)o.apply(e,c);return t["*"]&&"*"!=r&&e.trigger.apply(e,["*",r].concat(c)),e},enumerable:!1,writable:!1,configurable:!1}}),e},b=/^.+?\/\/+[^\/]+/,w="EventListener",y="remove"+w,A="add"+w,S="hasAttribute",E="popstate",P="hashchange",$="trigger",x=3,K="undefined"!=typeof window&&window,N="undefined"!=typeof document&&document,O=K&&history,T=K&&(O.location||K.location),j=i.prototype,k=N&&N.ontouchstart?"touchstart":"click",q=g(),D=!1,L=!1,R=[],_=0;j.m=function(e,t,n){!u(e)||t&&!u(t)?t?this.r(e,t):this.r("@",e):s(e,t,n||!1)},j.s=function(){this.off("*"),this.$=[]},j.e=function(e){this.$.concat("@").some(function(t){var n=("@"===t?m:v)(o(e),o(t));return"undefined"!=typeof n?(this[$].apply(null,[t].concat(n)),L=!0):void 0},this)},j.r=function(e,t){"@"!==e&&(e="/"+o(e),this.$.push(e)),this.on(e,t)};var z=new i,B=z.m.bind(z);return B.create=function(){var e=new i,t=e.m.bind(e);return t.stop=e.s.bind(e),t},B.base=function(e){h=e||"#",d=f()},B.exec=function(){c(!0)},B.parser=function(n,r){n||r||(m=e,v=t),n&&(m=n),r&&(v=r)},B.query=function(){var e={},t=T.href||d;return t.replace(/[?&](.+?)=([^&]*)/g,function(t,n,r){e[n]=r}),e},B.stop=function(){D&&(K&&(K[y](E,p),K[y](P,p),N[y](k,l)),q[$]("stop"),D=!1)},B.start=function(e){D||(K&&("interactive"===document.readyState||"complete"===document.readyState?r(e):document.onreadystatechange=function(){"interactive"===document.readyState&&setTimeout(function(){r(e)},1)}),D=!0)},window.ESPA.observable=g,B.base(),B.parser(),B}();